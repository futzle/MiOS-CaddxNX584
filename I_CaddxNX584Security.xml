<?xml version="1.0"?>
<implementation>
	<settings>
		<protocol>raw</protocol>
	</settings>
	<functions>
local plugin

function caddxInitialize(lul_device)
	-- Put the /etc/cmh-ludl and /etc/cmh-lu directories into the Lua include path.
	if (package.path:find("/etc/cmh-ludl/?.lua;/etc/cmh-lu/?.lua", 1, true) == nil) then
		package.path = package.path .. ";/etc/cmh-ludl/?.lua;/etc/cmh-lu/?.lua"
	end
	-- Load the Lua implementation.
	package.loaded.L_CaddxNX584Security = nil
	plugin = require("L_CaddxNX584Security")
	-- For when jobs are complete, get the results.
	-- Tunnel through from the plugin package to the top level.
	callbackHandler = plugin.callbackHandler
	-- Call initialization code.
	return plugin.caddxInitialize(lul_device)
end
	</functions>

	<incoming>
		<lua>
			plugin.handleReadByteResult(nil, lul_device, plugin.readByte(lul_data));
		</lua>
	</incoming>

	<startup>caddxInitialize</startup>

	<actionList>
		<action>
			<serviceId>urn:futzle-com:serviceId:CaddxNX584Security1</serviceId>
			<name>ZoneScan</name>
			<job>
				return plugin.jobZoneScan(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
		<action>
			<serviceId>urn:futzle-com:serviceId:CaddxNX584Security1</serviceId>
			<name>ZoneNameScan</name>
			<job>
				return plugin.jobZoneNameScan(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
		<action>
			<serviceId>urn:micasaverde-com:serviceId:SecuritySensor1</serviceId>
			<name>SetArmed</name>
			<job>
				return plugin.jobSetArmed(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
		<action>
			<serviceId>urn:micasaverde-com:serviceId:AlarmPartition1</serviceId>
			<name>RequestQuickArmMode</name>
			<job>
				return plugin.jobRequestQuickArmMode(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
		<action>
			<serviceId>urn:micasaverde-com:serviceId:AlarmPartition1</serviceId>
			<name>RequestArmMode</name>
			<job>
				return plugin.jobRequestArmMode(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
		<action>
			<serviceId>urn:micasaverde-com:serviceId:AlarmPartition1</serviceId>
			<name>RequestPanicMode</name>
			<job>
				return plugin.jobRequestPanicMode(lul_device, lul_settings, lul_job)
			</job>
			<incoming>
				return plugin.handleReadByteResult(lul_job, lul_device, plugin.readByte(lul_data));
			</incoming>
		</action>
	</actionList>
</implementation>
